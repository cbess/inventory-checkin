{% extends "base.tpl" %}

{% if current_user %}
{% set can_edit = current_user.is_authenticated() %}
{% endif %}

{% block header %}
{% if not can_edit and inventory_auto_refresh %}
<meta http-equiv="refresh" content="{{ inventory_auto_refresh }}">
{% endif %}

<link rel="stylesheet" href="/static/css/toastr.css" type="text/css" charset="utf-8">
<script src="/static/js/jquery.string.min.js"></script>
<script src="/static/js/inventory.js"></script>
<meta id='inventory-meta' data-confirmation-checkin="{% if confirmation.checkin %}yes{% else %}no{% endif %}">
{% endblock %}

{% block top_banner %}
{# remove the menu #}
<form action="{{ url_for('inventory_view') }}" method="GET" id="group-form">
    <select id="group-list" name="group">
        <option value="">All</option>
        {% for group in groups %}
        <option value="{{ group.identifier }}" {% if group.identifier == group_id %}SELECTED{% endif %}>{{ group.name }}</option>
        {% endfor %}
    </select>
</form>
{% endblock %}

{% block content %}
<div id="inventory">
    <div class="alert alert-info">
        Updated!
    </div>

    <table id="items" class="table">
        <tbody>
        {% for item in items %}
            {% set checked_out = item.status == 2 %}
            {% set latest_person = item.get_latest_person() %}

            <tr id="item-{{ item.id }}" 
                data-item-id="{{ item.id }}"
                data-checked-out="{% if checked_out %}yes{% else %}no{% endif %}">
                <td>
                    <div class='item-data btn btn-block {% if checked_out %}btn-inverse{% endif %}'>
                        <div class="device-name row-component" data-name='{{ item.name }}'>
                            <strong>{{ item.name }}</strong>
                        </div>
                        
                        <div class="person row-component {% if checked_out %}hidden{% endif %}">
                            {% if can_edit %}
                            <select class="person-list" {% if checked_out %}DISABLED{% endif %}>
                                <option value="0">Available</option>
                                {% for person in persons %}
                                    {% set selected = '' %}
                                    {% if checked_out %}
                                        {# only if it is checked out do we grab the latest person #}
                                        {% if latest_person.id == person.id %}{% set selected = 'SELECTED' %}{% endif %}
                                    {% endif %}
                                    <option value="{{ person.id }}" {{ selected }}>{{ person.name }}</option>
                                {% endfor %}
                            </select>
                            {% elif checked_out %}
                                {{ latest_person.name }}
                            {% else %}
                                <span class="label label-success">Available</span>
                            {% endif %}
                        </div>
                    </div>
                </td>
            </tr>
        {% else %}
            No {{ INVENTORY_ITEM_NAME_PLURAL.lower() }}.
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}