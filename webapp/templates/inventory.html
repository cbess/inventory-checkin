{% extends "base.tpl" %}

{% set can_edit = user.is_authenticated() %}

{% block header %}
{% if not user.is_authenticated() %}
<meta http-equiv="refresh" content="{{ inventory_auto_refresh }}">
{% endif %}

<link rel="stylesheet" href="/static/css/toastr.css" type="text/css" charset="utf-8">
<script src="/static/js/jquery.string.min.js"></script>
<script src="/static/js/inventory.js"></script>
<meta id='inventory-meta' data-confirmation-checkin="{% if confirmation.checkin %}yes{% else %}no{% endif %}">
{% endblock %}

{% block top_banner %}
{# remove the menu #}
<form action="{{ url_for('inventory_view') }}" method="GET" id="group-form">
    <select id="group-list" name="group">
        <option value="">All</option>
        {% for group in groups %}
        <option value="{{ group.id }}" {% if group.id == group_id %}SELECTED{% endif %}>{{ group.name }}</option>
        {% endfor %}
    </select>
</form>
{% endblock %}

{% block content %}
<div id="inventory">
    <div class="alert alert-info">
        Updated!
    </div>

    <table id="items" class="table table-striped">
        <tbody>
        {% for item in items %}
            {% set checked_out = item.status == 2 %}
            {% set latest_person = item.get_latest_person() %}

            <tr id="item-{{ item.id }}">
                <td class="device-name" data-name='{{ item.name }}'>
                    <strong>{{ item.name }}</strong>
                </td>
                <td class="person">
                    {% if can_edit %}
                    <select class="person-list" {% if checked_out %}DISABLED{% endif %}>
                        <option value="0">Available</option>
                    {% for person in persons %}
                        {% set selected = '' %}
                        {% if checked_out %}
                            {# only if it is checked out do we grab the latest person #}
                            {% if latest_person.id == person.id %}{% set selected = 'SELECTED' %}{% endif %}
                        {% endif %}
                        <option value="{{ person.id }}" {{ selected }}>{{ person.name }}</option>
                    {% endfor %}
                    {% elif checked_out %}
                        {{ latest_person.name }}
                    {% else %}
                        <span class="label label-success">Available</span>
                    {% endif %}
                    </select>
                </td>
                <td class="action">
                    <input type="checkbox" class="checkbox" value="{{ item.id }}"
                        {% if not can_edit %}DISABLED{% endif %}
                        {% if checked_out %}CHECKED{% endif %}
                        />
                </td>
            </tr>
        {% else %}
            No {{ INVENTORY_ITEM_NAME_PLURAL.lower() }}.
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}